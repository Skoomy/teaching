.PHONY: help install dev build preview docker-build docker-up docker-down docker-restart docker-logs clean clean-docker clean-all

# Variables
DOCKER_IMAGE_NAME = snake-game
DOCKER_CONTAINER_NAME = snake-game-demo
PORT = 3000

# Couleurs pour l'affichage
GREEN = \033[0;32m
YELLOW = \033[0;33m
RED = \033[0;31m
NC = \033[0m # No Color

# Commande par dÃ©faut
help:
	@echo "$(GREEN)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(GREEN)â•‘                 ğŸ Snake Game - Commandes                â•‘$(NC)"
	@echo "$(GREEN)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(YELLOW)ğŸ“¦ Installation et dÃ©veloppement local:$(NC)"
	@echo "  make install       - Installer les dÃ©pendances npm"
	@echo "  make dev          - Lancer en mode dÃ©veloppement (port 5173)"
	@echo "  make build        - Construire pour la production"
	@echo "  make preview      - PrÃ©visualiser la version de production"
	@echo ""
	@echo "$(YELLOW)ğŸ³ Docker:$(NC)"
	@echo "  make docker-build - Construire l'image Docker"
	@echo "  make up           - Lancer avec docker-compose"
	@echo "  make down         - ArrÃªter et supprimer les conteneurs"
	@echo "  make restart      - RedÃ©marrer les conteneurs"
	@echo "  make logs         - Voir les logs du conteneur"
	@echo "  make docker-shell - Ouvrir un shell dans le conteneur"
	@echo ""
	@echo "$(YELLOW)ğŸ§¹ Nettoyage:$(NC)"
	@echo "  make clean        - Nettoyer les fichiers de build et node_modules"
	@echo "  make clean-docker - Nettoyer les images et conteneurs Docker"
	@echo "  make clean-all    - Nettoyer tout (local + Docker)"
	@echo ""
	@echo "$(YELLOW)ğŸš€ Raccourcis:$(NC)"
	@echo "  make start        - Alias pour 'make up'"
	@echo "  make stop         - Alias pour 'make down'"
	@echo ""

# Installation et dÃ©veloppement local
install:
	@echo "$(GREEN)ğŸ“¦ Installation des dÃ©pendances...$(NC)"
	npm install
	@echo "$(GREEN)âœ… Installation terminÃ©e!$(NC)"

dev:
	@echo "$(GREEN)ğŸš€ Lancement en mode dÃ©veloppement...$(NC)"
	@echo "$(YELLOW)ğŸ“ Application disponible sur http://localhost:5173$(NC)"
	npm run dev

build:
	@echo "$(GREEN)ğŸ”¨ Construction pour la production...$(NC)"
	npm run build
	@echo "$(GREEN)âœ… Build terminÃ©! Fichiers dans ./dist$(NC)"

preview:
	@echo "$(GREEN)ğŸ‘ï¸  PrÃ©visualisation de la version de production...$(NC)"
	npm run preview

# Docker
docker-build:
	@echo "$(GREEN)ğŸ³ Construction de l'image Docker...$(NC)"
	docker build -t $(DOCKER_IMAGE_NAME) .
	@echo "$(GREEN)âœ… Image Docker construite: $(DOCKER_IMAGE_NAME)$(NC)"

up: docker-build
	@echo "$(GREEN)ğŸš€ Lancement avec docker-compose...$(NC)"
	docker-compose up -d
	@echo "$(GREEN)âœ… Application lancÃ©e!$(NC)"
	@echo "$(YELLOW)ğŸ“ Accessible sur http://localhost:$(PORT)$(NC)"

down:
	@echo "$(YELLOW)â¹ï¸  ArrÃªt des conteneurs...$(NC)"
	docker-compose down
	@echo "$(GREEN)âœ… Conteneurs arrÃªtÃ©s et supprimÃ©s$(NC)"

restart:
	@echo "$(YELLOW)ğŸ”„ RedÃ©marrage des conteneurs...$(NC)"
	docker-compose restart
	@echo "$(GREEN)âœ… Conteneurs redÃ©marrÃ©s$(NC)"

logs:
	@echo "$(YELLOW)ğŸ“‹ Logs du conteneur (Ctrl+C pour quitter):$(NC)"
	docker-compose logs -f

docker-shell:
	@echo "$(YELLOW)ğŸš Ouverture d'un shell dans le conteneur...$(NC)"
	docker exec -it $(DOCKER_CONTAINER_NAME) /bin/sh

# Nettoyage
clean:
	@echo "$(RED)ğŸ§¹ Nettoyage des fichiers locaux...$(NC)"
	rm -rf node_modules dist package-lock.json
	@echo "$(GREEN)âœ… Nettoyage local terminÃ©$(NC)"

clean-docker:
	@echo "$(RED)ğŸ³ Nettoyage Docker...$(NC)"
	docker-compose down -v --rmi all
	@echo "$(GREEN)âœ… Images et conteneurs Docker supprimÃ©s$(NC)"

clean-all: clean clean-docker
	@echo "$(GREEN)âœ… Nettoyage complet terminÃ©$(NC)"

# Alias
start: up
stop: down

# Installation rapide et lancement
quick-start: install dev

# Docker quick start
docker-start: docker-build up logs